(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{140:function(e,t,r){"use strict";r.r(t);var n=r(78),a=r(18),o=r(19),i=r(23),s=r(20),c=r(22),u=r(0),E=r.n(u),l=r(10),h=r.n(l),d=(r(86),r(145)),f=r(152),T=r(147),g=r(146),p=r(148),m=r(42),v=r(11),_=r(70),y=r.n(_),w=r(150),N=r(151),k=r(39),S=r(71),b={verovio:"https://www.verovio.org/javascript/develop/verovio-toolkit.js"},I=E.a.createContext({}),M=E.a.createContext({}),A=I.Provider,C=I.Consumer,V=M.Provider,D=M.Consumer,R=r(149),U=r(144),P=r(13),O=r(14),L=r(38),x=r(15),H=r(16),F=r(72),B=r.n(F),G=r(77),j={isNotUTF8:function(e,t,r){try{j.getStringFromBytes(e,t,r,!0)}catch(n){return!0}return!1},getCharLength:function(e){return 240===(240&e)?4:224===(224&e)?3:192===(192&e)?2:e===(127&e)?1:0},getCharCode:function(e,t,r){var n=0,a="";if(t=t||0,e.length-t<=0)throw new Error("No more characters remaining in array.");if(0===(r=r||j.getCharLength(e[t])))throw new Error("".concat(e[t].toString(2)," is not a significative")+" byte (offset:".concat(t,")."));if(1===r)return e[t];if(e.length-t<r)throw new Error("Expected at least ".concat(r," bytes remaining in array."));if(a="00000000".slice(0,r)+1+"00000000".slice(r+1),e[t]&parseInt(a,2))throw Error("Index ".concat(t,": A ").concat(r," bytes")+" encoded char"+" cannot encode the ".concat(r+1,"th rank bit to 1."));for(a="0000".slice(0,r+1)+"11111111".slice(r+1),n+=(e[t]&parseInt(a,2))<<6*--r;r;){if(128!==(128&e[t+1])||64===(64&e[t+1]))throw Error("Index ".concat(t+1,": Next bytes of encoded char")+' must begin with a "10" bit sequence.');n+=(63&e[++t])<<6*--r}return n},getStringFromBytes:function(e,t,r,n){var a,o=[];for(t|=0,r="number"===typeof r?r:e.byteLength||e.length;t<r;t++){if(t+(a=j.getCharLength(e[t]))>r){if(n)throw Error("Index ".concat(t,": Found a ").concat(a," bytes encoded \n            char declaration but only ").concat(r-t," bytes are available."))}else o.push(String.fromCodePoint(j.getCharCode(e,t,a,n)));t+=a-1}return o.join("")},getBytesForCharCode:function(e){if(e<128)return 1;if(e<2048)return 2;if(e<65536)return 3;if(e<2097152)return 4;throw new Error("CharCode ".concat(e," cannot be encoded with UTF8."))},setBytesFromCharCode:function(e,t,r,n){if(e|=0,t=t||[],r|=0,1===(n=n||j.getBytesForCharCode(e)))t[r]=e;else for(t[r++]=(parseInt("1111".slice(0,n),2)<<8-n)+(e>>>6*--n);n>0;)t[r++]=e>>>6*--n&63|128;return t},setBytesFromString:function(e,t,r,n,a){e=e||"",t=t||[],r|=0,n="number"===typeof n?n:t.byteLength||1/0;for(var o=0,i=e.length;o<i;o++){var s=j.getBytesForCharCode(e[o].codePointAt(0));if(a&&r+s>n)throw new Error('Not enought bytes to encode the char "'.concat(e[o],'" at the offset "').concat(r,'".'));j.setBytesFromCharCode(e[o].codePointAt(0),t,r,s,a),r+=s}return t}};function K(){throw new Error("MIDIEvents function not intended to be run.")}function z(e){var t;if(e){if(!(e instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(this.datas=new DataView(e,0,z.HEADER_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"h"!==String.fromCharCode(this.datas.getUint8(2))||"d"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileHeader : MThd prefix not found");if(6!==this.datas.getUint32(4))throw new Error("Invalid MIDIFileHeader : Chunk length must be 6")}else(t=new Uint8Array(z.HEADER_LENGTH))[0]=77,t[1]=84,t[2]=104,t[3]=100,t[4]=0,t[5]=0,t[6]=0,t[7]=6,t[8]=0,t[9]=1,t[10]=0,t[11]=1,t[12]=0,t[13]=192,this.datas=new DataView(t.buffer,0,z.HEADER_LENGTH)}function Y(e,t){var r,n;if(e){if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer received.");if(e.byteLength-t<12)throw new Error("Invalid MIDIFileTrack (0x".concat(t.toString(16),") :")+" Buffer length must size at least 12bytes");if(this.datas=new DataView(e,t,Y.HDR_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"r"!==String.fromCharCode(this.datas.getUint8(2))||"k"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileTrack (0x".concat(t.toString(16),") :")+" MTrk prefix not found");if(n=this.getTrackLength(),e.byteLength-t<n)throw new Error("Invalid MIDIFileTrack (0x".concat(t.toString(16),") :")+" The track size exceed the buffer length.");if(this.datas=new DataView(e,t,Y.HDR_LENGTH+n),255!==this.datas.getUint8(Y.HDR_LENGTH+(n-3))||47!==this.datas.getUint8(Y.HDR_LENGTH+(n-2))||0!==this.datas.getUint8(Y.HDR_LENGTH+(n-1)))throw new Error("Invalid MIDIFileTrack (0x".concat(t.toString(16),") :")+" No track end event found at the expected index"+" (".concat((Y.HDR_LENGTH+(n-1)).toString(16),")."))}else(r=new Uint8Array(12))[0]=77,r[1]=84,r[2]=114,r[3]=107,r[4]=0,r[5]=0,r[6]=0,r[7]=4,r[8]=0,r[9]=255,r[10]=47,r[11]=0,this.datas=new DataView(r.buffer,0,Y.HDR_LENGTH+4)}function X(e,t){var r,n,a,o;if(e){if((e=function(e){if(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array)return new Uint8Array(e).buffer}throw new Error("Unsupported buffer type, need ArrayBuffer or Uint8Array")}(e)).byteLength<25)throw new Error("A buffer of a valid MIDI file must have, at least, a size of 25bytes.");for(this.header=new z(e,t),this.tracks=[],n=z.HEADER_LENGTH,a=0,o=this.header.getTracksCount();a<o;a++){if(t&&n>=e.byteLength-1)throw new Error('Couldn"t find datas corresponding to the track #'.concat(a,"."));r=new Y(e,n,t),this.tracks.push(r),n+=r.getTrackLength()+8}if(t&&n!==e.byteLength)throw new Error("It seems that the buffer contains too much datas.")}else this.header=new z,this.tracks=[new Y]}K.EVENT_META=255,K.EVENT_SYSEX=240,K.EVENT_DIVSYSEX=247,K.EVENT_MIDI=8,K.EVENT_META_SEQUENCE_NUMBER=0,K.EVENT_META_TEXT=1,K.EVENT_META_COPYRIGHT_NOTICE=2,K.EVENT_META_TRACK_NAME=3,K.EVENT_META_INSTRUMENT_NAME=4,K.EVENT_META_LYRICS=5,K.EVENT_META_MARKER=6,K.EVENT_META_CUE_POINT=7,K.EVENT_META_MIDI_CHANNEL_PREFIX=32,K.EVENT_META_END_OF_TRACK=47,K.EVENT_META_SET_TEMPO=81,K.EVENT_META_SMTPE_OFFSET=84,K.EVENT_META_TIME_SIGNATURE=88,K.EVENT_META_KEY_SIGNATURE=89,K.EVENT_META_SEQUENCER_SPECIFIC=127,K.EVENT_MIDI_NOTE_OFF=8,K.EVENT_MIDI_NOTE_ON=9,K.EVENT_MIDI_NOTE_AFTERTOUCH=10,K.EVENT_MIDI_CONTROLLER=11,K.EVENT_MIDI_PROGRAM_CHANGE=12,K.EVENT_MIDI_CHANNEL_AFTERTOUCH=13,K.EVENT_MIDI_PITCH_BEND=14,K.MIDI_1PARAM_EVENTS=[K.EVENT_MIDI_PROGRAM_CHANGE,K.EVENT_MIDI_CHANNEL_AFTERTOUCH],K.MIDI_2PARAMS_EVENTS=[K.EVENT_MIDI_NOTE_OFF,K.EVENT_MIDI_NOTE_ON,K.EVENT_MIDI_NOTE_AFTERTOUCH,K.EVENT_MIDI_CONTROLLER,K.EVENT_MIDI_PITCH_BEND],K.createParser=function(e,t,r){var n,a,o,i,s;if(e instanceof DataView&&(e={position:t||0,buffer:e,readUint8:function(){return this.buffer.getUint8(this.position++)},readUint16:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readUint32:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readVarInt:function(){for(var e,t=0,r=0;r++<4;){if(!(128&(e=this.readUint8())))return t+e;t+=127&e,t<<=7}throw new Error("0x".concat(this.position.toString(16),":")+" Variable integer length cannot exceed 4 bytes")},readBytes:function(e){for(var t=[];e>0;e--)t.push(this.readUint8());return t},pos:function(){return"0x".concat((this.buffer.byteOffset+this.position).toString(16))},end:function(){return this.position===this.buffer.byteLength}},t=0),t>0)for(;t--;)e.readUint8();return{next:function(){if(e.end())return null;if(a={index:e.pos(),delta:e.readVarInt()},240===(240&(n=e.readUint8()))){if(n!==K.EVENT_META){if(n===K.EVENT_SYSEX||n===K.EVENT_DIVSYSEX)return a.type=n,a.length=e.readVarInt(),a.data=e.readBytes(a.length),a;if(r)throw new Error("".concat(e.pos()," Unknown event type ").concat(n.toString(16),", Delta: ").concat(a.delta,"."));return a.type=n,a.badsubtype=e.readVarInt(),a.length=e.readUint8(),a.data=e.readBytes(a.length),a}switch(a.type=K.EVENT_META,a.subtype=e.readUint8(),a.length=e.readVarInt(),a.subtype){case K.EVENT_META_SEQUENCE_NUMBER:if(r&&2!==a.length)throw new Error("".concat(e.pos()," Bad metaevent length."));return a.msb=e.readUint8(),a.lsb=e.readUint8(),a;case K.EVENT_META_TEXT:case K.EVENT_META_COPYRIGHT_NOTICE:case K.EVENT_META_TRACK_NAME:case K.EVENT_META_INSTRUMENT_NAME:case K.EVENT_META_LYRICS:case K.EVENT_META_MARKER:case K.EVENT_META_CUE_POINT:return a.data=e.readBytes(a.length),a;case K.EVENT_META_MIDI_CHANNEL_PREFIX:if(r&&1!==a.length)throw new Error("".concat(e.pos()," Bad metaevent length."));return a.prefix=e.readUint8(),a;case K.EVENT_META_END_OF_TRACK:if(r&&0!==a.length)throw new Error("".concat(e.pos()," Bad metaevent length."));return a;case K.EVENT_META_SET_TEMPO:if(r&&3!==a.length)throw new Error("".concat(e.pos()," Tempo meta event length must be 3."));return a.tempo=(e.readUint8()<<16)+(e.readUint8()<<8)+e.readUint8(),a.tempoBPM=6e7/a.tempo,a;case K.EVENT_META_SMTPE_OFFSET:if(r&&5!==a.length)throw new Error("".concat(e.pos()," Bad metaevent length."));if(a.hour=e.readUint8(),r&&a.hour>23)throw new Error("".concat(e.pos()," SMTPE offset hour value must")+" be part of 0-23.");if(a.minutes=e.readUint8(),r&&a.minutes>59)throw new Error("".concat(e.pos()," SMTPE offset minutes value")+" must be part of 0-59.");if(a.seconds=e.readUint8(),r&&a.seconds>59)throw new Error("".concat(e.pos()," SMTPE offset seconds value")+" must be part of 0-59.");if(a.frames=e.readUint8(),r&&a.frames>30)throw new Error("".concat(e.pos()," SMTPE offset frames value must")+" be part of 0-30.");if(a.subframes=e.readUint8(),r&&a.subframes>99)throw new Error("".concat(e.pos()," SMTPE offset subframes value")+" must be part of 0-99.");return a;case K.EVENT_META_KEY_SIGNATURE:if(r&&2!==a.length)throw new Error("".concat(e.pos()," Bad metaevent length."));if(a.key=e.readUint8(),r&&(a.key<-7||a.key>7))throw new Error("".concat(e.pos()," Bad metaevent length."));if(a.scale=e.readUint8(),r&&0!==a.scale&&1!==a.scale)throw new Error("".concat(e.pos()," Key signature scale value must")+" be 0 or 1.");return a;case K.EVENT_META_TIME_SIGNATURE:if(r&&4!==a.length)throw new Error("".concat(e.pos()," Bad metaevent length."));return a.data=e.readBytes(a.length),a.param1=a.data[0],a.param2=a.data[1],a.param3=a.data[2],a.param4=a.data[3],a;case K.EVENT_META_SEQUENCER_SPECIFIC:return a.data=e.readBytes(a.length),a;default:if(r)throw new Error("".concat(e.pos()," Unknown meta event type ")+"(".concat(a.subtype.toString(16),")."));return a.data=e.readBytes(a.length),a}}else{if(0===(128&n)){if(!o)throw new Error("".concat(e.pos()," Running status without previous event"));s=n}else o=n>>4,i=15&n,s=e.readUint8();switch(a.type=K.EVENT_MIDI,a.subtype=o,a.channel=i,a.param1=s,o){case K.EVENT_MIDI_NOTE_OFF:return a.param2=e.readUint8(),a;case K.EVENT_MIDI_NOTE_ON:return a.param2=e.readUint8(),a.param2||(a.subtype=K.EVENT_MIDI_NOTE_OFF,a.param2=127),a;case K.EVENT_MIDI_NOTE_AFTERTOUCH:case K.EVENT_MIDI_CONTROLLER:return a.param2=e.readUint8(),a;case K.EVENT_MIDI_PROGRAM_CHANGE:case K.EVENT_MIDI_CHANNEL_AFTERTOUCH:return a;case K.EVENT_MIDI_PITCH_BEND:return a.param2=e.readUint8(),a;default:if(r)throw new Error("".concat(e.pos()," Unknown MIDI event type ")+"(".concat(o.toString(16),")."));return a}}}}},K.writeToTrack=function(e,t,r){var n,a,o,i,s=0;for(n=0,a=e.length;n<a;n++){if(e[n].delta>>>28)throw Error("Event #".concat(n,": Maximum delta time value reached (").concat(e[n].delta,"/134217728 max)"));if(e[n].delta>>>21&&(t[s++]=e[n].delta>>>21&127|128),e[n].delta>>>14&&(t[s++]=e[n].delta>>>14&127|128),e[n].delta>>>7&&(t[s++]=e[n].delta>>>7&127|128),t[s++]=127&e[n].delta,e[n].type===K.EVENT_MIDI)t[s++]=(e[n].subtype<<4)+e[n].channel,t[s++]=e[n].param1,-1!==K.MIDI_2PARAMS_EVENTS.indexOf(e[n].subtype)&&(t[s++]=e[n].param2);else{if(t[s++]=e[n].type,e[n].type===K.EVENT_META&&(t[s++]=e[n].subtype),e[n].length>>>28)throw Error("Event #".concat(n,": Maximum length reached (").concat(e[n].length,"/134217728 max)"));if(e[n].length>>>21&&(t[s++]=e[n].length>>>21&127|128),e[n].length>>>14&&(t[s++]=e[n].length>>>14&127|128),e[n].length>>>7&&(t[s++]=e[n].length>>>7&127|128),t[s++]=127&e[n].length,e[n].type===K.EVENT_META)switch(e[n].subtype){case K.EVENT_META_SEQUENCE_NUMBER:t[s++]=e[n].msb,t[s++]=e[n].lsb;break;case K.EVENT_META_TEXT:case K.EVENT_META_COPYRIGHT_NOTICE:case K.EVENT_META_TRACK_NAME:case K.EVENT_META_INSTRUMENT_NAME:case K.EVENT_META_LYRICS:case K.EVENT_META_MARKER:case K.EVENT_META_CUE_POINT:for(o=0,i=e[n].length;o<i;o++)t[s++]=e[n].data[o];break;case K.EVENT_META_MIDI_CHANNEL_PREFIX:t[s++]=e[n].prefix;break;case K.EVENT_META_END_OF_TRACK:break;case K.EVENT_META_SET_TEMPO:t[s++]=e[n].tempo>>16,t[s++]=e[n].tempo>>8&255,t[s++]=255&e[n].tempo;break;case K.EVENT_META_SMTPE_OFFSET:if(r&&e[n].hour>23)throw new Error("Event #".concat(n,": SMTPE offset hour value must be")+" part of 0-23.");if(t[s++]=e[n].hour,r&&e[n].minutes>59)throw new Error("Event #".concat(n,": SMTPE offset minutes value must")+" be part of 0-59.");if(t[s++]=e[n].minutes,r&&e[n].seconds>59)throw new Error("Event #".concat(n,": SMTPE offset seconds value must")+" be part of 0-59.");if(t[s++]=e[n].seconds,r&&e[n].frames>30)throw new Error("Event #".concat(n,": SMTPE offset frames amount must")+" be part of 0-30.");if(t[s++]=e[n].frames,r&&e[n].subframes>99)throw new Error("Event #".concat(n,": SMTPE offset subframes amount")+" must be part of 0-99.");t[s++]=e[n].subframes;break;case K.EVENT_META_KEY_SIGNATURE:if("number"!==typeof e[n].key||e[n].key<-7||e[n].scale>7)throw new Error("Event #".concat(n,":The key signature key must be")+" between -7 and 7");if("number"!==typeof e[n].scale||e[n].scale<0||e[n].scale>1)throw new Error("Event #".concat(n,":")+"The key signature scale must be 0 or 1");t[s++]=e[n].key,t[s++]=e[n].scale;break;case K.EVENT_META_TIME_SIGNATURE:case K.EVENT_META_SEQUENCER_SPECIFIC:default:for(o=0,i=e[n].length;o<i;o++)t[s++]=e[n].data[o]}else for(o=0,i=e[n].length;o<i;o++)t[s++]=e[n].data[o]}}},K.getRequiredBufferLength=function(e){var t,r=0,n=0;for(n=0,t=e.length;n<t;n++)r+=e[n].delta>>>21?4:e[n].delta>>>14?3:e[n].delta>>>7?2:1,e[n].type===K.EVENT_MIDI?(r++,r++,-1!==K.MIDI_2PARAMS_EVENTS.indexOf(e[n].subtype)&&r++):(r++,e[n].type===K.EVENT_META&&r++,r+=e[n].length>>>21?4:e[n].length>>>14?3:e[n].length>>>7?2:1,r+=e[n].length);return r},z.HEADER_LENGTH=14,z.FRAMES_PER_SECONDS=1,z.TICKS_PER_BEAT=2,z.prototype.getFormat=function(){var e=this.datas.getUint16(8);if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI file : MIDI format (".concat(e,"),")+" format can be 0, 1 or 2 only.");return e},z.prototype.setFormat=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI format given (".concat(e,"),")+" format can be 0, 1 or 2 only.");this.datas.setUint16(8,e)},z.prototype.getTracksCount=function(){return this.datas.getUint16(10)},z.prototype.setTracksCount=function(e){return this.datas.setUint16(10,e)},z.prototype.getTickResolution=function(e){return 32768&this.datas.getUint16(12)?1e6/(this.getSMPTEFrames()*this.getTicksPerFrame()):(e=e||5e5)/this.getTicksPerBeat()},z.prototype.getTimeDivision=function(){return 32768&this.datas.getUint16(12)?z.FRAMES_PER_SECONDS:z.TICKS_PER_BEAT},z.prototype.getTicksPerBeat=function(){var e=this.datas.getUint16(12);if(32768&e)throw new Error("Time division is not expressed as ticks per beat.");return e},z.prototype.setTicksPerBeat=function(e){this.datas.setUint16(12,32767&e)},z.prototype.getSMPTEFrames=function(){var e,t=this.datas.getUint16(12);if(!(32768&t))throw new Error("Time division is not expressed as frames per seconds.");if(-1===[24,25,29,30].indexOf(e=32512&t))throw new Error("Invalid SMPTE frames value (".concat(e,")."));return 29===e?29.97:e},z.prototype.getTicksPerFrame=function(){var e=this.datas.getUint16(12);if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");return 255&e},z.prototype.setSMTPEDivision=function(e,t){if(29.97===e&&(e=29),-1===[24,25,29,30].indexOf(e))throw new Error("Invalid SMPTE frames value given (".concat(e,")."));if(t<0||t>255)throw new Error("Invalid ticks per frame value given (".concat(e,")."));this.datas.setUint8(12,128|e),this.datas.setUint8(13,t)},Y.HDR_LENGTH=8,Y.prototype.getTrackLength=function(){return this.datas.getUint32(4)},Y.prototype.setTrackLength=function(e){return this.datas.setUint32(4,e)},Y.prototype.getTrackContent=function(){return new DataView(this.datas.buffer,this.datas.byteOffset+Y.HDR_LENGTH,this.datas.byteLength-Y.HDR_LENGTH)},Y.prototype.setTrackContent=function(e){var t,r,n,a,o=e.byteLength-e.byteOffset;if(o<4)throw new Error("Invalid track length, must size at least 4bytes");for(this.datas=new DataView(new Uint8Array(Y.HDR_LENGTH+o).buffer),this.datas.setUint8(0,77),this.datas.setUint8(1,84),this.datas.setUint8(2,114),this.datas.setUint8(3,107),this.datas.setUint32(4,o),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=new Uint8Array(this.datas.buffer,Y.HDR_LENGTH,o),n=0,a=t.length;n<a;n++)r[n]=t[n]},X.prototype.startNote=function(e,t){this.takeTrack(e.channel,t).notes.push({when:e.playTime/1e3,pitch:e.param1,duration:1e-7,slides:[]})},X.prototype.closeNote=function(e,t){for(var r=this.takeTrack(e.channel,t),n=0;n<r.notes.length;n++)if(1e-7==r.notes[n].duration&&r.notes[n].pitch==e.param1&&r.notes[n].when<e.playTime/1e3){r.notes[n].duration=e.playTime/1e3-r.notes[n].when;break}},X.prototype.addSlide=function(e,t){for(var r=this.takeTrack(e.channel,t),n=0;n<r.notes.length;n++)1e-7==r.notes[n].duration&&r.notes[n].when<e.playTime/1e3&&r.notes[n].slides.push({pitch:r.notes[n].pitch+(e.param2-64)/6,when:e.playTime/1e3-r.notes[n].when})},X.prototype.startDrum=function(e,t){this.takeBeat(e.param1,t).notes.push({when:e.playTime/1e3})},X.prototype.takeTrack=function(e,t){for(var r=0;r<t.tracks.length;r++)if(t.tracks[r].n==e)return t.tracks[r];var n={n:e,notes:[],volume:1,program:0};return t.tracks.push(n),n},X.prototype.takeBeat=function(e,t){for(var r=0;r<t.beats.length;r++)if(t.beats[r].n==e)return t.beats[r];var n={n:e,notes:[],volume:1};return t.beats.push(n),n},X.prototype.parseSong=function(){for(var e={duration:0,tracks:[],beats:[]},t=this.getMidiEvents(),r=0;r<t.length;r++)if(e.duration<t[r].playTime/1e3&&(e.duration=t[r].playTime/1e3),t[r].subtype==K.EVENT_MIDI_NOTE_ON)9==t[r].channel?t[r].param1>=35&&t[r].param1<=81?this.startDrum(t[r],e):console.log("wrong drum",t[r]):t[r].param1>=0&&t[r].param1<=127?this.startNote(t[r],e):console.log("wrong tone",t[r]);else if(t[r].subtype==K.EVENT_MIDI_NOTE_OFF)9!=t[r].channel&&this.closeNote(t[r],e);else if(t[r].subtype==K.EVENT_MIDI_PROGRAM_CHANGE){if(9!=t[r].channel)this.takeTrack(t[r].channel,e).program=t[r].param1;else console.log("skip program for drums")}else if(t[r].subtype==K.EVENT_MIDI_CONTROLLER){if(7==t[r].param1)if(9!=t[r].channel)this.takeTrack(t[r].channel,e).volume=t[r].param2/127||1e-6}else t[r].subtype==K.EVENT_MIDI_PITCH_BEND?this.addSlide(t[r],e):console.log("unknown",t[r].channel,t[r]);return e},X.prototype.getEvents=function(e,t){var r,n,a,o,i,s,c=0,u=[],E=this.header.getFormat(),l=this.header.getTickResolution();if(1!==E||1===this.tracks.length)for(a=0,o=this.tracks.length;a<o;a++)for(c=2===E&&c?c:0,n=(r=K.createParser(this.tracks[a].getTrackContent(),0,!1)).next();n;)c+=n.delta?n.delta*l/1e3:0,n.type===K.EVENT_META&&n.subtype===K.EVENT_META_SET_TEMPO&&(l=this.header.getTickResolution(n.tempo)),e&&n.type!==e||t&&(!n.subtype||n.subtype!==t)||(n.playTime=c,u.push(n)),n=r.next();else{for(i=[],s=-1,a=0,o=this.tracks.length;a<o;a++)i[a]={},i[a].parser=K.createParser(this.tracks[a].getTrackContent(),0,!1),i[a].curEvent=i[a].parser.next();do{for(s=-1,a=0,o=i.length;a<o;a++)i[a].curEvent&&(-1===s||i[a].curEvent.delta<i[s].curEvent.delta)&&(s=a);if(-1!==s){for(a=0,o=i.length;a<o;a++)a!==s&&i[a].curEvent&&(i[a].curEvent.delta-=i[s].curEvent.delta);c+=(n=i[s].curEvent).delta?n.delta*l/1e3:0,n.type===K.EVENT_META&&n.subtype===K.EVENT_META_SET_TEMPO&&(l=this.header.getTickResolution(n.tempo)),e&&n.type!==e||t&&(!n.subtype||n.subtype!==t)||(n.playTime=c,n.track=s,u.push(n)),i[s].curEvent=i[s].parser.next()}}while(-1!==s)}return u},X.prototype.getMidiEvents=function(){return this.getEvents(K.EVENT_MIDI)},X.prototype.getLyrics=function(){var e,t,r,n=this.getEvents(K.EVENT_META),a=[],o=[];for(t=0,r=n.length;t<r;t++)(e=n[t]).subtype===K.EVENT_META_LYRICS?o.push(e):e.subtype===K.EVENT_META_TEXT&&("@"===String.fromCharCode(e.data[0])?"T"===String.fromCharCode(e.data[1])||"I"===String.fromCharCode(e.data[1])||String.fromCharCode(e.data[1]):0===String.fromCharCode.apply(String,Object(G.a)(e.data)).indexOf("words")?a.length=0:0!==e.playTime&&a.push(e));o.length>2?a=o:a.length||(a=[]);try{a.forEach(function(e){e.text=j.getStringFromBytes(e.data,0,e.length,!0)})}catch(i){a.forEach(function(e){e.text=e.data.map(function(e){return String.fromCharCode(e)}).join("")})}return a},X.prototype.getTrackEvents=function(e){var t,r,n=[];if(e>this.tracks.length||e<0)throw Error("Invalid track index (".concat(e,")"));t=(r=K.createParser(this.tracks[e].getTrackContent(),0,!1)).next();do{n.push(t),t=r.next()}while(t);return n},X.prototype.setTrackEvents=function(e,t){var r,n;if(e>this.tracks.length||e<0)throw Error("Invalid track index (".concat(e,")"));if(!t||!t.length)throw Error("A track must contain at least one event, none given.");r=K.getRequiredBufferLength(t),n=new Uint8Array(r),K.writeToTrack(t,n),this.tracks[e].setTrackContent(n)},X.prototype.deleteTrack=function(e){if(e>this.tracks.length||e<0)throw Error("Invalid track index (".concat(e,")"));this.tracks.splice(e,1),this.header.setTracksCount(this.tracks.length)},X.prototype.addTrack=function(e){var t;if(e>this.tracks.length||e<0)throw Error("Invalid track index (".concat(e,")"));t=new Y,e===this.tracks.length?this.tracks.push(t):this.tracks.splice(e,0,t),this.header.setTracksCount(this.tracks.length)},X.prototype.getContent=function(){var e,t,r,n,a,o,i,s,c;for(e=z.HEADER_LENGTH,n=0,a=this.tracks.length;n<a;n++)e+=this.tracks[n].getTrackLength()+8;for(t=new Uint8Array(e),r=new Uint8Array(this.header.datas.buffer,this.header.datas.byteOffset,z.HEADER_LENGTH),n=0,a=z.HEADER_LENGTH;n<a;n++)t[n]=r[n];for(o=0,i=this.tracks.length;o<i;o++)for(r=new Uint8Array(this.tracks[o].datas.buffer,this.tracks[o].datas.byteOffset,this.tracks[o].datas.byteLength),s=0,c=this.tracks[o].datas.byteLength;s<c;s++)t[n++]=r[s];return t.buffer},X.Header=z,X.Track=Y;var Q,q=X,W=function(e){for(var t=window.atob(e),r=t.length,n=new Uint8Array(r),a=0;a<r;a++)n[a]=t.charCodeAt(a);return n.buffer},J=function(e,t){for(var r=0;r<e.loader.instrumentKeys().length;r++)if(t===1*e.loader.instrumentKeys()[r].substring(0,3))return r},$=function(e){function t(){var e,r;Object(a.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(r=Object(i.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).state={currentSongTime:0,reverberator:{},isPlayed:!1,leftTime:0,nextPositionTime:0,nextStepTime:0,playMode:"loop",player:{},playing:!1,progress:0,song:{beats:[],duration:0,tracks:[]},songStart:0,volume:1},r.audioContextFunc=window.AudioContext||window.webkitAudioContext,r.audioContext=new r.audioContextFunc,r.midiFile=new q,r.midiSoundsRef=E.a.createRef(),r.scrubberRef=E.a.createRef(),r.stepDuration=.5,r.handleAdjustPlay=r.handleAdjustPlay.bind(Object(v.a)(Object(v.a)(r))),r.startPlay=function(){var e=r.state,t=e.isPlayed,n=e.song,a=e.progress;if(e.player.cancelQueue(r.audioContext),t){var o=n.duration*a/100;r.setState(function(e){return{songStart:e.songStart-(o-e.currentSongTime),currentSongTime:o}})}else r.setState(function(e){return{isPlayed:!e.isPlayed,currentSongTime:0,songStart:r.audioContext.currentTime,nextStepTime:r.audioContext.currentTime}});return r.tick()},r.handleAdjustVolume=function(){r.setState(function(e){return{volume:2===e.volume?0:e.volume+1}})},r.tick=function(){var e=r.state,t=e.currentSongTime,n=e.nextStepTime,a=e.song;e.playing&&a&&(r.audioContext.currentTime>n-r.stepDuration&&(r.sendNotes(t,t+r.stepDuration),r.setState(function(e){return{progress:Math.round(100*e.currentSongTime/e.song.duration),currentSongTime:e.currentSongTime+r.stepDuration,nextStepTime:e.nextStepTime+r.stepDuration}}),t>a.duration&&r.setState({progress:0,playing:!1,isPlayed:!1,currentSongTime:0,songStart:0})),window.requestAnimationFrame(function(){r.tick()}))},r.sendNotes=function(e,t){var n=r.state,a=n.song,o=n.songStart,i=n.reverberator,s=n.player;if(a){for(var c=0;c<a.tracks.length;c++)for(var u=a.tracks[c],E=0;E<u.notes.length;E++)if(u.notes[E].when>=e&&u.notes[E].when<t){var l=o+u.notes[E].when,h=u.notes[E].duration;h>3&&(h=3);var d=u.info.variable,f=u.volume/7;s&&s.queueWaveTable(r.audioContext,i,window[d],l,u.notes[E].pitch,h,f,u.notes[E].slides)}for(var T=0;T<a.beats.length;T++)for(var g=a.beats[T],p=0;p<g.notes.length;p++)if(g.notes[p].when>=e&&g.notes[p].when<t){var m=o+g.notes[p].when,v=g.info.variable,_=g.volume/2;s&&s.queueWaveTable(r.audioContext,i,window[v],m,g.n,1.5,_)}}},r.seek=function(e){var t=r.state,n=t.player,a=t.song;if(n.cancelQueue(r.audioContext),r.scrubberRef){var o=r.scrubberRef.getBoundingClientRect(),i=(e.clientX-o.left)/o.width*100,s=a.duration*i/100;r.setState(function(e){return{progress:i,playing:!0,songStart:e.songStart-(s-e.currentSongTime),currentSongTime:s}})}},r.parseMIDISong=function(){var e=r.props.midi;if(e){var t=W(e),n=new q(t).parseSong();r.setState({song:n})}},r.startLoad=function(){r.midiSoundsRef.current&&r.setState({player:r.midiSoundsRef.current.player},function(){var e=r.state,t=e.song,n=e.player,a=n.createReverberator(r.audioContext);a.output.connect(r.audioContext.destination),r.setState({reverberator:a.input});for(var o=0;o<t.tracks.length;o++){var i=J(n,t.tracks[o].program),s=n.loader.instrumentInfo(i);t.tracks[o].info=s,t.tracks[o].id=i,n.loader.startLoad(r.audioContext,s.url,s.variable)}})},r}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidUpdate",value:function(e,t){var r=this.state,n=r.song,a=r.playing,o=r.currentSongTime,i=this.props,s=i.midi,c=i.updateScore,u=i.vrvToolkit;if(s!==e.midi&&this.parseMIDISong(),n!==t.song&&this.startLoad(),a!==t.playing&&this.startPlay(),o!==t.currentSongTime){var E=Math.max(0,1e3*o),l=u.getElementsAtTime(E);return c(l.notes,l.page)}}},{key:"handleAdjustPlay",value:function(){this.setState(function(e){return{playing:!e.playing}})}},{key:"render",value:function(){var e=this;return E.a.createElement(V,{value:this.state},E.a.createElement(f.a,{direction:"row",align:"center",justify:"between"},E.a.createElement(Z,{onClick:this.handleAdjustPlay}),E.a.createElement(f.a,{direction:"row",align:"center",flex:!0,ref:function(t){e.scrubberRef=t}},E.a.createElement(te,{onClick:this.seek})),E.a.createElement(f.a,null,E.a.createElement(ee,{onClick:function(){return e.handleAdjustVolume()}}))),E.a.createElement(B.a,{appElementName:"root",ref:this.midiSoundsRef}))}}]),t}(u.Component),Z=function(e){var t=e.onClick;return E.a.createElement(D,null,function(e){var r=e.playing;return E.a.createElement(R.a,{hoverIndicator:"background",icon:r?E.a.createElement(P.a,null):E.a.createElement(O.a,null),onClick:t})})},ee=function(e){var t=e.onClick,r=[E.a.createElement(L.a,null),E.a.createElement(x.a,null),E.a.createElement(H.a,null)];return E.a.createElement(D,null,function(e){var n=e.volume;return E.a.createElement(R.a,{hoverIndicator:"background",icon:r[n],onClick:t})})},te=function(e){var t=e.onClick;return E.a.createElement(D,null,function(e){var r=e.progress;return E.a.createElement(U.a,{"aria-label":"Audio progress",type:"bar",size:"full",onClick:t,thickness:"small",values:[{color:"accent-1",value:r}]})})},re=$,ne=function(){return E.a.createElement(f.a,{direction:"row",justify:"between"},E.a.createElement(ae,null),E.a.createElement(oe,null))},ae=function(){return E.a.createElement(C,null,function(e){var t=e.totalPages,r=e.currentPage;return E.a.createElement(f.a,{direction:"row"},E.a.createElement(w.a,{color:"accent-1"},r),E.a.createElement(w.a,null,"/ ",t))})},oe=function(){return E.a.createElement(C,null,function(e){var t=e.visibleOptions;return E.a.createElement(f.a,{gap:"small",direction:"row",justify:"between"},Object.keys(t).map(function(e){return E.a.createElement(N.a,{key:e,label:E.a.createElement(w.a,null,e)})}))})},ie=(Q=function(){return E.a.createElement(C,null,function(e){var t=e.isLoaded,r=e.error,n=e.musicScoreSvg;return t&&!r?E.a.createElement(f.a,{background:"none",animation:"fadeIn",margin:"small",dangerouslySetInnerHTML:{__html:n}}):E.a.createElement(f.a,{align:"center",alignContent:"center",animation:"fadeIn",justify:"center",height:"210px",round:"small",margin:"small",background:"light-2"},E.a.createElement(k.a,null),E.a.createElement(w.a,{margin:"small",color:"dark-5"},"Loading Music Score..."))})},function(e){function t(){var e,r;Object(a.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(r=Object(i.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).state={error:!1,errorMessage:"",musicScore:null,musicScoreSvg:null,midi:null,page:{},isLoaded:!1,scriptCache:{},currentPage:1,totalPages:0,visibleOptions:{note:!0,tick:!0,measure:!0}},r.updateScoreFollowingMIDI=r.updateScoreFollowingMIDI.bind(Object(v.a)(Object(v.a)(r))),r.vrvToolkit={},r.handleKeyPress=function(e){var t={ArrowLeft:function(){return r.movePrevPage()},ArrowRight:function(){return r.moveNextPage()},ArrowUp:function(){},ArrowDown:function(){},default:function(){}};(t[(e=e||window.event).key]||t.default)()},r}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.fetchScoreData(),this.initVrvToolkit(),document.addEventListener("keydown",this.handleKeyPress,!1)}},{key:"componentDidUpdate",value:function(e){var t=this.state.isLoaded;this.props.page!==e.page&&t&&this.reloadScoreSVG()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyPress,!1)}},{key:"setScoreOption",value:function(){var e=this.props.page,t={pageHeight:100*e.height/e.zoom,pageWidth:100*e.width/e.zoom,scale:e.zoom,adjustPageHeight:!0};this.vrvToolkit&&e&&this.vrvToolkit.setOptions(t)}},{key:"initScorePage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.vrvToolkit){this.setScoreOption(),this.vrvToolkit.redoLayout();var t=this.vrvToolkit.renderToSVG(e,{}),r=this.vrvToolkit.getPageCount(),n="".concat(this.vrvToolkit.renderToMIDI());this.setState({musicScoreSvg:t,midi:n,totalPages:r})}}},{key:"reloadScoreSVG",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.vrvToolkit){this.setScoreOption(),this.vrvToolkit.redoLayout();var t=this.vrvToolkit.renderToSVG(e,{});this.setState({musicScoreSvg:t})}}},{key:"moveNextPage",value:function(){var e=this.state,t=e.currentPage;t<e.totalPages&&(this.setState(function(e){return{currentPage:e.currentPage+1}}),this.reloadScoreSVG(t+1))}},{key:"goToPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.setState({currentPage:e}),this.reloadScoreSVG(e)}},{key:"movePrevPage",value:function(){var e=this.state.currentPage;e>1&&(this.setState(function(e){return{currentPage:e.currentPage-1}}),this.reloadScoreSVG(e-1))}},{key:"fetchScoreData",value:function(){var e=this;y()({method:"get",url:"/static/chopin10_3.mei",responseType:"text"}).then(function(t){e.setState({musicScore:t.data})}).catch(function(t){e.setState({error:!0,errorMessage:t})})}},{key:"initVrvToolkit",value:function(){var e=this,t=this.state.scriptCache;t&&t.verovio.onLoad(function(t,r){e.setState({error:r.error,isLoaded:!0},function(){e.vrvToolkit=new window.verovio.toolkit,e.vrvToolkit&&e.loadScore()})})}},{key:"loadScore",value:function(){var e=this.state.musicScore;this.vrvToolkit.loadData(e),this.initScorePage()}},{key:"updateScoreFollowingMIDI",value:function(e,t){t!==this.state.currentPage&&this.goToPage(t)}},{key:"render",value:function(){var e=this.state.midi;return E.a.createElement("div",null,E.a.createElement(A,{value:this.state},E.a.createElement(ne,null),E.a.createElement(Q,null)),E.a.createElement(re,{vrvToolkit:this.vrvToolkit,updateScore:this.updateScoreFollowingMIDI,getElementsAtTime:this.vrvToolkit.getElementsAtTime,midi:e}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.scriptCache?t.page!==e.page?{page:t.page}:null:{scriptCache:Object(S.a)({verovio:b.verovio})}}}]),t}(u.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var se={grommet:m.grommet,hpe:m.hpe,dark:m.dark},ce=function(e){function t(){var e,r;Object(a.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(r=Object(i.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).scoreEL=E.a.createRef(),r.pageEl=E.a.createRef(),r.state={scoreView:{height:0,width:0,zoom:40}},r}return Object(c.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.onScoreSizeChange(),window.addEventListener("resize",this.onScoreSizeChange.bind(this))}},{key:"onScoreSizeChange",value:function(){var e,t={width:(e=this.scoreEL).current.getBoundingClientRect().width,height:e.current.getBoundingClientRect().height},r=this.state.scoreView;this.setState({scoreView:Object(n.a)({},r,t)})}},{key:"render",value:function(){var e=this.state.scoreView;return E.a.createElement(d.a,{theme:se.grommet},E.a.createElement(f.a,null,E.a.createElement(T.a,{margin:"small",areas:[{name:"header",start:[0,0],end:[1,0]},{name:"main",start:[0,1],end:[1,1]},{name:"foot",start:[0,2],end:[1,2]}],columns:["auto"],rows:["auto","auto","auto"]},E.a.createElement(f.a,{direction:"row",gridArea:"header"},E.a.createElement(f.a,{pad:{between:"medium"}},E.a.createElement(g.a,{color:"brand",level:3,responsive:!0,textAlign:"center"},"MIDI performance Visualization"))),E.a.createElement(f.a,{ref:this.scoreEL,gridArea:"main"},E.a.createElement(ie,{page:e})),E.a.createElement(f.a,{gridArea:"foot",background:"dark"},E.a.createElement(f.a,null,E.a.createElement(p.a,{margin:"none"},"\xa9"))))))}}]),t}(E.a.Component);h.a.render(E.a.createElement(ce,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},71:function(e,t,r){"use strict";(function(e){var r=0,n=new Map;t.a=function(t){var a={onLoad:function(e){return function(t){var r=n.get(e);r&&r.promise.then(function(){r.error?t(r.error):t(null,r)})}}};return a.scriptTag=function(t,a){if(!n.has(t)){var o=document.createElement("script"),i={loaded:!1,error:!1,promise:new Promise(function(i,s){var c=document.getElementsByTagName("body")[0];o.type="text/javascript",o.crossorigin="crossorigin",o.async=!0;var u="loaderCB".concat(r++).concat(Date.now()),E=function(r){return function(o){var c=n.get(t);c.resolved=!1,c.resolved=!1,"loaded"===r?(c.resolved=!0,i(a)):"error"===r&&(c.errored=!0,s(o)),e[u]&&"function"===typeof e[u]&&(e[u]=null)}};return o.onload=E("loaded"),o.onerror=E("error"),o.onreadystatechange=function(){E(o.readyState)},a.match(/callback=CALLBACK_NAME/)?a=a.replace(/(callback=)[^&]+/,"$1".concat(u)):o.addEventListener("load",o.onload),o.addEventListener("error",o.onerror),o.src=a,c.appendChild(o),o}),tag:o};n.set(t,i)}return n.get(t)},Object.keys(t).forEach(function(e){var r=t[e];a[e]={tag:a.scriptTag(e,r),onLoad:a.onLoad(e)}}),a}}).call(this,r(62))},81:function(e,t,r){e.exports=r(140)},86:function(e,t,r){}},[[81,2,1]]]);
//# sourceMappingURL=main.b370c83c.chunk.js.map